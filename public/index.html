<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lance Workshop - Control Vehicular</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- PANTALLA DE LOGIN -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <h1 class="login-logo">Lance Workshop</h1>
            <p class="login-subtitle">Iniciar sesi√≥n en el panel</p>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="loginUser">Usuario</label>
                    <input type="text" id="loginUser" placeholder="Tu usuario" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label for="loginPass">Contrase√±a</label>
                    <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required>
                </div>
                <div id="loginError" class="login-error" style="display:none;"></div>
                <button type="submit" class="btn btn-primary btn-large login-btn" id="loginBtn">Entrar</button>
            </form>
            <p class="login-footer">Powered by Lance System</p>
        </div>
    </div>

    <!-- PANEL PRINCIPAL (oculto hasta login) -->
    <div id="panelScreen" style="display: none;">
    <header class="header">
        <div class="container">
            <h1 class="logo">Lance Workshop</h1>
            <p class="powered-by">Powered by Lance System</p>
            <p class="subtitle">Sistema de Control Vehicular</p>
            <p class="workshop-label" id="workshopLabel"></p>
            <div class="workshop-switch" id="workshopSwitch" style="display: none;">
                <label for="workshopSelect">Taller activo:</label>
                <select id="workshopSelect"></select>
                <button class="btn btn-small btn-manage-workshops" id="manageWorkshopsBtn" title="Gestionar talleres">‚öôÔ∏è</button>
                <button class="btn btn-small btn-manage-users" id="manageUsersBtn" title="Gestionar usuarios">üë§</button>
                <button class="btn btn-small btn-performance" id="performanceBtn" title="Rendimiento mec√°nicos">üìä</button>
            </div>
            <button class="btn btn-small btn-logout" id="logoutBtn" title="Cerrar sesi√≥n">üö™ Salir</button>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- Formulario de registro -->
            <section class="card">
                <h2>Registrar Veh√≠culo</h2>
                <form id="vehicleForm" class="form">
                    <div class="form-group">
                        <label for="plate">Matr√≠cula</label>
                        <input type="text" id="plate" name="plate" required 
                               placeholder="Ej: 3107 JBN" maxlength="20">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Tel√©fono</label>
                        <input type="tel" id="phone" name="phone" required 
                               placeholder="Ej: +34 612 345 678" maxlength="20">
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-large">
                        Registrar Veh√≠culo
                    </button>
                </form>
            </section>

            <!-- Mensaje de respuesta -->
            <div id="messageContainer" class="message-container" style="display: none;">
                <div id="messageContent" class="message"></div>
            </div>

            <!-- Tabla de veh√≠culos -->
            <section class="card">
                <h2>Veh√≠culos en Taller</h2>

                <div class="filters-row">
                    <div class="form-group search-group filter-item">
                        <label for="plateSearch">Buscar por matr√≠cula</label>
                        <input
                            type="text"
                            id="plateSearch"
                            placeholder="Escribe una matr√≠cula..."
                            autocomplete="off"
                        >
                    </div>
                    <div class="form-group filter-item">
                        <label for="statusFilter">Filtrar por estado</label>
                        <select id="statusFilter">
                            <option value="">Todos</option>
                            <option value="ESPERANDO_REVISION">Esperando revisi√≥n</option>
                            <option value="EN_REVISION">En revisi√≥n</option>
                            <option value="PRESUPUESTO_PENDIENTE">Presupuesto pendiente</option>
                            <option value="ESPERANDO_PIEZA">Esperando pieza</option>
                            <option value="MONTANDO_PIEZA">Montando pieza</option>
                            <option value="LISTO">Listo</option>
                        </select>
                    </div>
                    <div class="form-group filter-item">
                        <label for="mechanicFilter">Filtrar por mec√°nico</label>
                        <select id="mechanicFilter">
                            <option value="">Todos</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table id="vehiclesTable" class="table">
                        <thead>
                            <tr>
                                <th>Matr√≠cula</th>
                                <th>Tel√©fono</th>
                                <th>Entrada por</th>
                                <th>Estado</th>
                                <th>√öltimo cambio por</th>
                                <th>√öltima Actualizaci√≥n</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="vehiclesTableBody">
                            <!-- Los veh√≠culos se cargar√°n din√°micamente -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Mensaje cuando no hay veh√≠culos -->
                <div id="noVehiclesMessage" class="no-data" style="display: none;">
                    <p>No hay veh√≠culos registrados</p>
                </div>

                <div id="noSearchResultsMessage" class="no-data" style="display: none;">
                    <p>No se encontraron veh√≠culos con esa matr√≠cula.</p>
                </div>
            </section>

            <!-- Botones de estado -->
            <section class="card">
                <h2>Cambiar Estado del Veh√≠culo</h2>
                <p id="statusSectionInstruction" class="help-text">Selecciona un veh√≠culo para cambiar el estado.</p>
                
                <div class="status-buttons">
                    <button id="statusEsperandoRevision" class="btn btn-status btn-awaiting-review" disabled>
                        Esperando Revisi√≥n
                    </button>
                    <button id="statusEnRevision" class="btn btn-status btn-revision" disabled>
                        En Revisi√≥n
                    </button>
                    <button id="statusPresupuestoPendiente" class="btn btn-status btn-budget" disabled>
                        Presupuesto Pendiente
                    </button>
                    <button id="statusEsperandoPieza" class="btn btn-status btn-waiting" disabled>
                        Esperando Pieza
                    </button>
                    <button id="statusMontandoPieza" class="btn btn-status btn-mounting" disabled>
                        Montando Pieza
                    </button>
                    <button id="statusListo" class="btn btn-status btn-ready" disabled>
                        Listo
                    </button>
                </div>

                <div id="waitingPiecePanel" class="waiting-piece-panel" style="display: none;">
                    <div class="panel-header-row">
                        <h3>Esperando Pieza</h3>
                        <button id="toggleWaitingPieceDetailsBtn" type="button" class="btn btn-outline-details">Detalles</button>
                    </div>
                    <div id="waitingPieceDetails">
                        <div class="waiting-piece-grid">
                            <div class="form-group waiting-buttons-group">
                                <label>Sistema general</label>
                                <div id="repairSystemButtons" class="option-buttons"></div>
                            </div>
                            <div class="form-group waiting-buttons-group">
                                <label>Pieza</label>
                                <div id="repairPartButtons" class="option-buttons"></div>
                            </div>
                        </div>
                        <div class="waiting-piece-extra-actions">
                            <button id="addExtraRepairBtn" type="button" class="btn btn-secondary">+ A√±adir pieza</button>
                        </div>
                        <div id="extraRepairList" class="extra-repair-list" style="display: none;"></div>
                        <div class="form-group">
                            <label for="repairNoteInput">Nota (opcional)</label>
                            <input type="text" id="repairNoteInput" maxlength="120" placeholder="Ej: Pendiente proveedor / referencia exacta">
                        </div>
                        <button id="applyEsperandoPiezaBtn" class="btn btn-primary">Aplicar Esperando Pieza</button>
                    </div>
                </div>
                
                <div id="selectedVehicleInfo" class="selected-info">
                    <p id="selectedVehicleText">Veh√≠culo seleccionado: <strong id="selectedPlate">Ninguno</strong></p>
                </div>

                <div id="budgetPdfPanel" class="waiting-piece-panel">
                    <h3>Presupuesto PDF</h3>
                    <div class="form-group">
                        <label for="budgetPdfFile">Subir presupuesto final (PDF)</label>
                        <input type="file" id="budgetPdfFile" accept="application/pdf">
                    </div>
                    <div class="form-row">
                        <button id="uploadBudgetPdfBtn" type="button" class="btn btn-primary">Subir PDF</button>
                        <button id="viewBudgetPdfBtn" type="button" class="btn btn-secondary">Ver PDF</button>
                    </div>
                    <p id="budgetPdfInfo" class="pdf-info-text">Selecciona un veh√≠culo para gestionar presupuesto.</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal de edici√≥n -->
    <div id="editModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>‚úèÔ∏è Editar Veh√≠culo</h3>
                <button class="modal-close" id="closeEditModalBtn">&times;</button>
            </div>
            <form id="editForm">
                <input type="hidden" id="editVehicleId">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="editPlate">Matr√≠cula</label>
                        <input type="text" id="editPlate" maxlength="20" placeholder="Ej: 3107 JBN">
                    </div>
                    <div class="form-group">
                        <label for="editPhone">Tel√©fono</label>
                        <input type="tel" id="editPhone" maxlength="20" placeholder="Ej: +34 612 345 678">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelEditModalBtn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de gesti√≥n de talleres -->
    <div id="workshopModal" class="modal-overlay" style="display: none;">
        <div class="modal modal-wide">
            <div class="modal-header">
                <h3>üè≠ Gesti√≥n de Talleres</h3>
                <button class="modal-close" id="closeWorkshopModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Formulario para agregar taller -->
                <div class="workshop-add-form">
                    <h4>Agregar nuevo taller</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newWorkshopName">Nombre del taller</label>
                            <input type="text" id="newWorkshopName" placeholder="Ej: Taller Garc√≠a" maxlength="60">
                        </div>
                        <button type="button" class="btn btn-primary" id="addWorkshopBtn">+ Agregar</button>
                    </div>
                </div>

                <!-- Lista de talleres -->
                <div class="workshop-list-section">
                    <h4>Talleres</h4>
                    <div id="workshopListManage" class="workshop-list-manage">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de gesti√≥n de usuarios -->
    <div id="usersModal" class="modal-overlay" style="display: none;">
        <div class="modal modal-wide">
            <div class="modal-header">
                <h3>üë§ Usuarios del Taller</h3>
                <button class="modal-close" id="closeUsersModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="workshop-add-form">
                    <h4>Crear usuario</h4>
                    <div class="form-row users-form-row">
                        <div class="form-group">
                            <label for="newMechanicName">Nombre</label>
                            <input type="text" id="newMechanicName" placeholder="Ej: Carlos Mu√±oz" maxlength="60">
                        </div>
                        <div class="form-group">
                            <label for="newMechanicUsername">Usuario</label>
                            <input type="text" id="newMechanicUsername" placeholder="Ej: carlos.m" maxlength="30">
                        </div>
                        <div class="form-group">
                            <label for="newMechanicPassword">Contrase√±a</label>
                            <input type="password" id="newMechanicPassword" placeholder="M√≠nimo 6 caracteres" maxlength="60">
                        </div>
                        <div class="form-group" id="roleSelectGroup" style="display: none;">
                            <label for="newUserRole">Rol</label>
                            <select id="newUserRole">
                                <option value="mechanic">Mec√°nico</option>
                                <option value="due√±o">Due√±o</option>
                            </select>
                        </div>
                        <button type="button" class="btn btn-primary" id="addMechanicBtn">+ Crear</button>
                    </div>
                </div>

                <div class="workshop-list-section">
                    <h4>Usuarios del taller activo</h4>
                    <div id="usersListManage" class="workshop-list-manage"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de rendimiento de mec√°nicos -->
    <div id="performanceModal" class="modal-overlay" style="display: none;">
        <div class="modal modal-wide">
            <div class="modal-header">
                <h3>üìä Rendimiento de Mec√°nicos</h3>
                <button class="modal-close" id="closePerformanceModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="performanceContent">
                    <p style="color: #64748b; text-align: center;">Cargando estad√≠sticas...</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>Powered by Lance System</p>
        </div>
    </footer>
    </div><!-- fin panelScreen -->

    <script src="app.js"></script>
</body>
</html>